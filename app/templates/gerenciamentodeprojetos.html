{% extends "base.html" %}

{% block title %}Gerenciamento de Projetos{% endblock %}

{% block content %}
<h1 class="text-center text-neon mt-5">Gerenciamento de Projetos</h1>
<div class="board-container" id="boardContainer">
    <!-- O conteúdo das colunas será renderizado aqui -->
</div>

<div class="create-column-container">
    <button class="create-column-btn" onclick="toggleColumnInput()"><i class="fas fa-plus"></i></button>
    <div class="column-input-wrapper">
        <input type="text" id="columnNameInput" placeholder="Digite o nome da nova coluna">
        <button class="confirm-column-btn" onclick="createColumn()"><i class="fas fa-check"></i></button>
    </div>
</div>

<script>
    function toggleColumnInput() {
        const inputWrapper = document.querySelector('.column-input-wrapper');
        inputWrapper.style.display = inputWrapper.style.display === 'flex' ? 'none' : 'flex';
    }

    function createColumn() {
        const input = document.getElementById('columnNameInput');
        const columnName = input.value.trim();
        if (columnName) {
            const boardContainer = document.getElementById('boardContainer');

            const newColumn = document.createElement('div');
            newColumn.classList.add('column');
            newColumn.setAttribute('data-column-id', `column-${Date.now()}`);
            newColumn.style.backgroundColor = '#b0b0b0'; // Define a cor padrão cinza
            newColumn.innerHTML = `
                <div class="column-header">
                    ${columnName}
                    <div class="menu-icon" onclick="toggleMenu(this)">
                        &#x22EE;
                    </div>
                    <div class="menu-options">
                        <div class="color-options">
                            <button class="color-btn" style="background-color: #FF5733;" onclick="setColor(this)"></button>
                            <button class="color-btn" style="background-color: #33FF57;" onclick="setColor(this)"></button>
                            <button class="color-btn" style="background-color: #3357FF;" onclick="setColor(this)"></button>
                            <button class="color-btn" style="background-color: #FF33A6;" onclick="setColor(this)"></button>
                            <button class="color-btn" style="background-color: #FFC300;" onclick="setColor(this)"></button>
                        </div>
                        <button onclick="renameColumn(this)"><i class="fas fa-paint-brush"></i> Renomear</button>
                        <div class="submenu">
                            <button class="submenu-btn">Ordenar por</button>
                            <div class="submenu-options">
                                <button onclick="sortTasks(this, 'recent')" class="sort-option active">Mais Recentes</button>
                                <button onclick="sortTasks(this, 'old')" class="sort-option">Mais Antigos</button>
                                <button onclick="sortTasks(this, 'alphabetical')" class="sort-option">Alfabeticamente</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="task-list"></div>
                <button class="add-task-btn" onclick="showTaskInput(this)"><i class="fas fa-plus"></i></button>
            `;

            boardContainer.appendChild(newColumn);
            input.value = ''; // Limpa o input após criar a coluna
            document.querySelector('.column-input-wrapper').style.display = 'none'; // Oculta o input após criar a coluna
        }
    }

    function showTaskInput(button) {
        const taskList = button.previousElementSibling;

        if (taskList.querySelector('.task-input')) {
            return; // Evita múltiplos campos de entrada
        }

        const inputContainer = document.createElement('div');
        inputContainer.classList.add('task-input-container');

        const input = document.createElement('input');
        input.type = 'text';
        input.placeholder = 'Digite o nome da tarefa';
        input.classList.add('task-input');

        const confirmButton = document.createElement('button');
        confirmButton.classList.add('confirm-task-btn');
        confirmButton.innerHTML = '<i class="fas fa-check"></i>'; // Ícone de confirmação

        confirmButton.onclick = function () {
            if (input.value.trim() !== '') {
                const task = document.createElement('div');
                task.classList.add('task');
                task.textContent = input.value.trim();
                task.dataset.timestamp = Date.now();
                taskList.appendChild(task);
                inputContainer.remove(); // Remove o campo de entrada após confirmar a tarefa
                button.innerHTML = '<i class="fas fa-plus"></i>'; // Retorna o botão de adicionar tarefa ao símbolo de "+"
            }
        };

        input.addEventListener('keypress', function (e) {
            if (e.key === 'Enter' && input.value.trim() !== '') {
                confirmButton.click(); // Simula o clique no botão de confirmação ao pressionar "Enter"
            }
        });

        inputContainer.appendChild(input);
        inputContainer.appendChild(confirmButton);
        taskList.appendChild(inputContainer);
        input.focus(); // Foca no input para começar a digitar imediatamente

        button.innerHTML = ''; // Remover conteúdo do botão de "+"
    }

    function toggleMenu(icon) {
        const menu = icon.nextElementSibling;
        if (menu.style.display === 'block') {
            menu.style.display = 'none';
        } else {
            document.querySelectorAll('.menu-options').forEach(m => m.style.display = 'none');
            menu.style.display = 'block';
            menu.style.position = 'fixed';

            const rect = icon.closest('.column').getBoundingClientRect();
            menu.style.left = `${rect.right + 10}px`;
            menu.style.top = `${rect.top}px`;

            if (menu.getBoundingClientRect().right > window.innerWidth) {
                menu.style.left = `${rect.left - menu.offsetWidth - 10}px`;
            }
        }
    }

    function setColor(button) {
        const column = button.closest('.column');
        column.style.backgroundColor = button.style.backgroundColor;
    }

    function renameColumn(button) {
        const columnHeader = button.closest('.column-header');
        const newName = prompt('Digite o novo nome da coluna:');
        if (newName) {
            columnHeader.childNodes[0].textContent = newName;
        }
    }

    function sortTasks(button, order) {
        const column = button.closest('.column');
        const taskList = column.querySelector('.task-list');
        const tasks = Array.from(taskList.children).filter(child => !child.classList.contains('task-input'));

        if (order === 'recent') {
            tasks.sort((a, b) => b.dataset.timestamp - a.dataset.timestamp);
        } else if (order === 'old') {
            tasks.sort((a, b) => a.dataset.timestamp - b.dataset.timestamp);
        } else if (order === 'alphabetical') {
            tasks.sort((a, b) => a.textContent.localeCompare(b.textContent));
        }

        tasks.forEach(task => taskList.appendChild(task));

        button.parentElement.querySelectorAll('.sort-option').forEach(opt => opt.classList.remove('active'));
        button.classList.add('active');
    }
</script>

<style>
    .board-container {
        display: flex;
        overflow-x: auto;
        padding: 20px;
        gap: 20px;
    }
    .column {
        background-color: #b0b0b0;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        width: 300px;
        flex-shrink: 0;
        display: flex;
        flex-direction: column;
        padding: 15px;
        position: relative;
    }
    .column-header {
        font-size: 1.2em;
        font-weight: bold;
        margin-bottom: 10px;
        text-align: center;
        position: relative;
    }
    .menu-icon {
        position: absolute;
        top: 0;
        right: 0;
        cursor: pointer;
    }
    .menu-options {
        display: none;
        background-color: #222;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        z-index: 10;
        padding: 5px;
        min-width: 150px;
    }
    .color-options {
        display: flex;
        justify-content: space-around;
        margin-bottom: 10px;
    }
    .color-btn {
        width: 20px;
        height: 20px;
        border: none;
        cursor: pointer;
        border-radius: 3px;
    }
    .menu-options button {
        background: none;
        border: none;
        color: #fff;
        padding: 8px 12px;
        text-align: left;
        width: 100%;
        cursor: pointer;
        display: flex;
        align-items: center;
    }
    .menu-options button:hover {
        background-color: #333;
    }
    .menu-options i {
        margin-right: 5px;
    }
    .submenu-options {
        display: none;
        position: absolute;
        left: 100%;
        top: 0;
        background-color: #333;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        z-index: 15;
        padding: 5px;
    }
    .submenu:hover .submenu-options {
        display: block;
    }
    .submenu-options button {
        padding: 5px 10px;
    }
    .task-list {
        margin-top: 10px;
    }
    .task-input-container {
        display: flex;
        align-items: center;
        margin-bottom: 5px;
    }
    .task-input {
        flex: 1;
        padding: 10px;
        margin-right: 5px;
        border: none;
        border-radius: 5px;
        outline: none;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .task {
        background-color: #444;
        color: #fff;
        margin-bottom: 5px;
        padding: 10px;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .add-task-btn {
        background: none;
        border: none;
        cursor: pointer;
        padding: 5px;
        font-size: 1.5em;
        color: #333;
    }
    .add-task-btn:hover {
        color: #39ff14;
    }
    .confirm-task-btn {
        background-color: #39ff14;
        border: none;
        border-radius: 5px;
        padding: 10px;
        cursor: pointer;
        color: #000;
    }
    .confirm-task-btn i {
        font-size: 1em;
    }
    .create-column-container {
        display: flex;
        align-items: center;
        position: relative;
        margin-top: 20px;
    }
    .create-column-btn {
        background-color: #39ff14;
        border: none;
        border-radius: 50%;
        padding: 15px;
        cursor: pointer;
        font-size: 1.5em;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s;
    }
    .create-column-btn:hover {
        background-color: #32cd12;
    }
    .column-input-wrapper {
        display: none;
        flex-direction: row;
        align-items: center;
        margin-left: 10px;
    }
    .column-input-wrapper input {
        padding: 10px;
        border: none;
        border-radius: 5px;
        margin-right: 5px;
        outline: none;
    }
    .confirm-column-btn {
        background-color: #39ff14;
        border: none;
        border-radius: 5px;
        padding: 10px;
        cursor: pointer;
        font-size: 1em;
        color: #000;
    }
</style>

<!-- Adicione o link para os ícones do Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" crossorigin="anonymous">
{% endblock %}
